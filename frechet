#!/usr/bin/env python3
import numpy as np
import sys
import os

from frechetlib.continuous_frechet import frechet_c_approx

def read_curve(filename):
    with open(filename, 'r') as f:
        lines = f.readlines()
        x = list(map(float, lines[0].split()))
        y = list(map(float, lines[1].split()))
        return np.array(list(zip(x, y)))

if len(sys.argv) != 3 or sys.argv[1] != '-id':
    print("Usage: ./frechet -id <id>")
    sys.exit(1)

test_case_id = sys.argv[2]
base = os.path.join('..', 'data', 'taxi_simplified', str(test_case_id))

original_path = os.path.join(base, 'original.txt')
targets = [
    ('simplified', os.path.join(base, 'simplified.txt')),
    ('dp_simplified', os.path.join(base, 'dp_simplified.txt')),
    ('operb_simplified', os.path.join(base, 'operb_simplified.txt')),
    ('fbqs_simplified', os.path.join(base, 'fbqs_simplified.txt')),
]

if not os.path.exists(original_path):
    print(f"Original file not found: {original_path}")
    sys.exit(1)

print("Reading curves...")
orig = read_curve(original_path)

print("Calculating Frechet distances (original vs X):")
for name, p in targets:
    if not os.path.exists(p):
        print(f"  {name}: MISSING ({p})")
        continue
    try:
        cur = read_curve(p)
        res, morphing = frechet_c_approx(orig, cur, 1.01)
        print(f"  {name}: {morphing.dist}")
    except Exception as e:
        print(f"  {name}: ERROR ({e})")